# 工具到智能体检索：连接工具与智能体的可扩展 LLM 多智能体系统 - 愫读摘要

**论文信息**
- **作者**：Elias Lumer, Faheem Nizar, Anmol Gulati, Pradeep Honaganahalli Basavaraju, Vamse Kumar Subbiah
- **机构**：普华永道美国
- **原文链接**：https://arxiv.org/abs/2511.01854

---

## 📋 整体概要

本文提出了**工具到智能体检索**（Tool-to-Agent Retrieval）框架，解决了 LLM 多智能体系统中工具和智能体路由的核心问题。该框架将工具及其父智能体统一嵌入共享向量空间，通过元数据关系连接，实现了细粒度的工具级或智能体级检索。在 LiveMCPBench 基准测试中，该方法相比之前的最佳方法实现了显著性能提升：Recall@5 提升 19.4%，nDCG@5 提升 17.7%。

---

## 🔍 按章节详细摘要

### 摘要部分

**核心问题**：
- LLM 多智能体系统需要协调数百或数千个工具或 MCP 服务器
- 现有检索方法通常只匹配粗粒度的智能体级描述，掩盖了细粒度工具功能
- 导致次优的智能体选择和上下文稀释问题

**解决方案**：
- 引入工具到智能体检索统一框架
- 将工具和父智能体嵌入共享向量空间，通过元数据关系连接
- 显式表示工具能力，支持工具级到智能体级的遍历

**主要成果**：
- 在八个嵌入模型上评估，实现 Recall@5 提升 19.4%，nDCG@5 提升 17.7%
- 确保工具和智能体得到平等表示，避免上下文稀释

### 1 引言部分

**背景与挑战**：
- **技术背景**：LLM 智能体和 MCP 协议的进步使助手能在推理时发现和使用大量工具
- **实践场景**：单个助手委托给专门子智能体（代码分析、数据库、网络搜索等）
- **核心挑战**：路由问题 - 选择特定工具还是整个智能体？
- **规模问题**：一个包含 26 个工具的 MCP 服务器可能消耗超过 4,600 个 token

**现有策略的局限性**：
1. **智能体优先管道**：
   - 优势：降低复杂度
   - 问题：可能隐藏高度相关工具，父描述与查询不一致时失效

2. **仅工具检索**：
   - 优势：细粒度匹配
   - 问题：忽略工具包的互补效益，多步任务表现不佳

**相关工作分类**：
- **工具检索基础**：通过嵌入工具描述和元数据构建知识库 [19,21,22,37]
- **RAG 方法**：通过语义搜索访问外部知识和工具 [7]
- **混合方法**：结合知识图谱和向量检索提高准确性 [32]
- **图方法**：ToolNet、ControlLLM 通过图结构组织工具 [16,17]
- **迭代方法**：ToolReAGT 分解复杂任务，逐步检索工具 [2,3]
- **多跳推理**：链接中间步骤增强检索 [34,36]
- **分层管道**：先选 MCP 服务器再选工具，但可能抑制细粒度匹配 [6,39]

**本文贡献**：
1. **统一检索框架**：工具和智能体嵌入共享空间，实现统一检索
2. **细粒度路由机制**：保留工具级细节和智能体级上下文
3. **全面评估**：在 LiveMCPBench 上验证 17.7%-19.4% 的性能提升

### 2 方法：工具到智能体检索

**核心架构**：
- **统一表示**：将工具和父智能体嵌入同一向量空间
- **二分图建模**：G = (A, T, E)
  - A 表示智能体 {a, b, ... x } 的集合
  - T 表示智能体 A 中智能体的工具集合 { Ta, Tb, ... Tx }
  - 边 E 表示工具和智能体之间的所有权关系
- **元数据链接**：显式链接工具到其父智能体

**技术优势**：
- 解决单级检索局限性
- 避免智能体描述掩盖工具级功能
- 防止工具检索丢失执行上下文（身份验证、参数推断、访问策略）
- 确保每个查询最终解析为可执行智能体

**索引系统**：
1. **工具语料库 CT**：
   - 包含工具名称和描述
   - 每个工具条目包含指向父智能体的元数据 owner(T) = A
   - 支持从检索工具遍历到可执行智能体

2. **智能体语料库 CA**：
   - 包含智能体名称和描述
   - 表示更高级别能力，作为检索图的父节点

**检索算法**：
- **目标**：为查询识别 top-K 最相关智能体
- **策略**：先检索 top N ≫ K 个实体，然后聚合选择 top-K 唯一智能体
- **方法**：结合语义和词汇匹配，利用 BM25 和密集向量检索

**算法 1 详细步骤**：
```
1. 输入：查询 q，语料库 C（智能体∪工具），截断值 N, K
2. 按相似度排序检索 top N 个实体
3. 遍历结果，将工具映射到其父智能体
4. 选择 top-K 唯一智能体作为输出
```

**查询范式**：
1. **直接查询**：
   - 直接使用用户高级问题作为检索查询
   - 适合整体任务检索

2. **逐步查询**（主要评估设置）：
   - 将原始查询分解为子任务
   - 每个步骤独立提交给检索器
   - 支持多步工作流程中的不同智能体识别
   - 结合查询重写技术改进语义匹配

### 3 实验与评估

**实验假设**：
- 统一检索器（工具+智能体）优于仅智能体检索器
- 在 MCP 环境中，改进扩展到路由初始阶段

**评估指标**：
- **召回率（Recall）**：检索相关项目的能力
- **平均精度均值（mAP）**：考虑排名质量的检索精度
- **标准化折扣累积增益（nDCG）**：考虑排名位置的检索质量

**数据集**：LiveMCPBench
- **规模**：70 个 MCP 服务器，527 个工具，95 个真实问题
- **结构**：带逐步分解和相关工具-智能体映射
- **特点**：平均每个问题 2.68 步骤，涉及 2.82 个工具和 1.40 个智能体
- **基线**：构建仅智能体数据集用于隔离工具级信息贡献

**比较方法**：
- **BM25**：传统的词汇匹配方法
- **ScaleMCP**：动态 MCP 工具管理方法 [21]
- **MCPZero**：主动工具发现方法 [6]

**检索器设置**：
- **嵌入模型**：8 个模型（闭源+开源）
  - Vertex AI text embedding 005
  - Gemini Embedding 001
  - Amazon titan embed text v1/v2
  - OpenAI text embedding ada 002, 3 small/large
  - All MiniLM L6 v2
- **评估流程**：检索 top N ≫ K 实体，使用算法 1 选择 top-K 唯一智能体

**实验结果**：

**表 1：LiveMCPBench 基准测试结果**
| 方法                 | Recall@5 | mAP@5    | nDCG@5   |
| -------------------- | -------- | -------- | -------- |
| BM25                 | 0.20     | 0.12     | 0.14     |
| Q.Retrieval          | 0.56     | 0.24     | 0.32     |
| MCPZero              | 0.70     | 0.31     | 0.41     |
| ScaleMCP             | 0.74     | 0.29     | 0.40     |
| **工具到智能体检索** | **0.83** | **0.34** | **0.46** |

**表 2：各嵌入模型对比**
| 嵌入模型         | Recall@5 提升    | nDCG@5 提升      |
| ---------------- | ---------------- | ---------------- |
| Amazon Titan v2  | +28% (0.66→0.85) | +27% (0.37→0.47) |
| All MiniLM L6 v2 | +13% (0.67→0.80) | +15% (0.39→0.45) |
| 其他模型         | +15%~+20%        | +15%~+20%        |

**关键发现**：
1. **一致性改进**：在所有八个嵌入模型上都显示稳定改进
2. **架构无关性**：Recall@5 标准差仅 0.02，nDCG@5 标准差仅 0.01
3. **性能来源**：
   - 39.13% 的检索 top-K 项目源自智能体语料库
   - 34.44% 的匹配 top-K 工具追溯到智能体语料库
   - 证明了联合索引的有效性

### 4 结论

**主要成果总结**：
- 提出了统一的工具到智能体检索框架
- 在共享向量空间中嵌入工具和智能体，通过元数据关系连接
- 在 LiveMCPBench 基准上实现显著性能提升
- 解决了现有方法的上下文稀释问题

**技术贡献**：
- **统一表示**：支持工具级和智能体级细粒度检索
- **上下文保留**：避免粗略摘要导致的上下文稀释
- **多步路由**：改进多步查询的鲁棒性
- **架构通用性**：在多种嵌入模型上表现稳定

**研究意义**：
- 为统一工具和智能体选择提供了新方向
- 激励了对复杂智能体网络扩展检索架构的研究
- 在 LLM 多智能体系统的可扩展编排方面迈出重要一步

---

## 💡 核心创新点

1. **统一检索范式**：首次将工具和智能体在同一向量空间中表示
2. **元数据遍历机制**：通过工具→智能体链接保留上下文信息
3. **避免上下文稀释**：细粒度表示避免了粗略摘要的信息损失
4. **多粒度检索**：支持工具级和智能体级的灵活检索决策
5. **架构无关性**：在多种嵌入模型上表现稳定

---

## 🎯 实际应用价值

- **大规模工具管理**：适用于管理数百或数千个工具的企业级场景
- **智能体协调**：支持多智能体系统中的高效路由和任务分配
- **成本优化**：减少不必要的 token 消耗，提高检索效率
- **系统扩展性**：为不断增长的工具生态系统提供可扩展的解决方案

---

## 📊 关键性能指标

- **最高相对改进**：Amazon Titan v2 上 Recall@5 +28%
- **平均性能提升**：Recall@5 +19.4%，nDCG@5 +17.7%
- **稳定性**：跨 8 个嵌入模型的标准差小于 0.02
- **效率提升**：支持一次性工具 vs 智能体决策，减少多步骤处理

---

*本摘要基于原文《Tool-to-Agent Retrieval: Bridging Tools and Agents for Scalable LLM Multi-Agent Systems》的中文翻译版本整理，保留了原文的核心技术细节和实验数据。*